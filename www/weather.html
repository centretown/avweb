{{ define "weather.common" }}
<div class="content grid-container">
    <div class="grid-label">Latitude</div>
    <div class="grid-label">Longitude</div>
    <div class="grid-label">Timezone</div>
    <div class="grid-label">Elevation</div>
    <div class="grid-data">{{printf "%5.2f" .Latitude}}</div>
    <div class="grid-data">{{printf "%5.2f" .Longitude}}</div>
    <div class="grid-data">{{.Timezone}}</div>
    <div class="grid-data">{{.Elevation}}</div>
</div>
{{ end }} {{ define "weather.sun" }}
<div id="slot-{{.Action.Name}}" class="slot" draggable="false">
    {{template "layout.content.head" .Action }}{{$codes := .Codes}}
    <div class="content scroll">
        {{range $location := .Data}}
        <div class="title">{{$location.City}}</div>
        <div class="grid-sun">
            <div class="grid-label"></div>
            <div class="grid-label">Day</div>
            <div class="grid-label">Daylight</div>
            <div class="grid-label">Sunshine</div>
            <div class="grid-label">Sunrise</div>
            <div class="grid-label">Sunset</div>
        </div>

        <div class="grid-sun">
            {{$daily := $location.WeatherDaily}} {{range $index, $time :=
            $daily.Daily.Time}}{{$code := index $daily.Daily.Code $index}}
            {{$icon := index $codes $code}}
            <span class="symbols-small">{{$icon}}</span>
            <div class="grid-data">{{$daily.FormatDay $index}}</div>
            <div class="grid-data">{{$daily.FormatDaylight $index}}</div>
            <div class="grid-data">{{$daily.FormatSunshine $index}}</div>
            <div class="grid-data">{{$daily.FormatSunrise $index}}</div>
            <div class="grid-data">{{$daily.FormatSunset $index}}</div>
            {{end}}
        </div>
        {{end}}
    </div>
</div>

{{ end }} {{ define "weather.daily" }}

<div id="slot-{{.Action.Name}}" class="slot" draggable="false">
    <script>
        var hideDaily = [];
        function toggleDaily(index) {
            let id = "daily" + index;
            if (hideDaily[index]) {
                hideDaily[index] = false;
                htmx.removeClass("#" + id, "hide");
            } else {
                hideDaily[index] = true;
                htmx.addClass("#" + id, "hide");
            }
        }
    </script>
    {{template "layout.content.head" .Action }}{{$codes := .Codes}}
    <div class="content scroll">
        {{range $loc, $location := .Data}}{{$daily := $location.WeatherDaily}}
        <div class="title">{{$location.City}}</div>
        <canvas
            class="chart"
            id="weather_canvas{{$loc}}"
            width="320"
            height="100"
            style="border: 1px solid yellow"
        ></canvas>
        <script>
            hideDaily.push(true);
            var val = minMax({{$daily.Daily.Low}},{{$daily.Daily.High}});
            var rdDaily = [];
            {{range $daily.Daily.Low}}rdDaily.push({{.}});{{end}}
            showGraph("weather_canvas{{$loc}}", "cyan",
              rdDaily, val.min, val.max);
            rdDaily = [];
            {{range $daily.Daily.High}}rdDaily.push({{.}});{{end}}
            showGraph("weather_canvas{{$loc}}", "red",
              rdDaily, val.min, val.max);
            showMinMax("weather_canvas{{$loc}}", val.min, val.max);
            rdDaily = [];
            {{range $daily.Daily.Time}}rdDaily.push({{.}});{{end}}
            showDays("weather_canvas{{$loc}}", rdDaily);
        </script>
        <button class="action" hx-on:click="toggleDaily({{$loc}})">
            <span class="symbols-small">more_horiz</span>
        </button>
        <div id="daily{{$loc}}" class="hide">
            <div class="grid-daily">
                <div class="grid-label"></div>
                <div class="grid-label">Day</div>
                <div class="grid-label">High</div>
                <div class="grid-label">Low</div>
                <div class="grid-label">Precip.</div>
                <div class="grid-label">UV</div>
            </div>

            <div class="grid-daily">
                {{range $index, $time := $daily.Daily.Time}}{{$code := index
                $daily.Daily.Code $index}} {{$icon := index $codes $code}}
                <span class="symbols-small">{{$icon}}</span>
                <div class="grid-data">{{$daily.FormatDay $index}}</div>
                <div class="grid-data">{{$daily.FormatHigh $index}}</div>
                <div class="grid-data">{{$daily.FormatLow $index}}</div>
                <div class="grid-data">
                    {{$daily.FormatPrecipitation $index}}
                </div>
                <div class="grid-data">{{$daily.FormatUvIndex $index}}</div>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>
</div>

{{ end }} {{ define "weather.hourly" }}
<div id="slot-{{.Action.Name}}" class="slot" draggable="false">
    <script>
        var hideHourly = [];
        function toggleHourly(index) {
            let id = "hourly" + index;
            if (hideHourly[index]) {
                hideHourly[index] = false;
                htmx.removeClass("#" + id, "hide");
            } else {
                hideHourly[index] = true;
                htmx.addClass("#" + id, "hide");
            }
        }
    </script>
    {{template "layout.content.head" .Action }}{{$codes := .Codes}}
    <div class="content scroll">
        {{range $loc, $location := .Data}} {{$hourly :=
        $location.WeatherHourly}}
        <div class="title">{{$location.City}}</div>
        <canvas
            class="chart"
            id="hourly_canvas{{$loc}}"
            width="320"
            height="100"
            style="border: 1px solid yellow"
        ></canvas>
        <script>
            hideHourly.push(true);
            var rdHourly = [];
            var val = minMax({{$hourly.Hourly.Temperature}},{{$hourly.Hourly.Temperature}});
            {{range $hourly.Hourly.Temperature}}rdHourly.push({{.}});{{end}}
            showGraph("hourly_canvas"+{{$loc}}, "cyan",
              rdHourly, val.min, val.max);
            showMinMax("hourly_canvas"+{{$loc}}, val.min, val.max);
            showHours("hourly_canvas"+{{$loc}}, {{$hourly.Hourly.Time}});
        </script>
        <button class="action" hx-on:click="toggleHourly({{$loc}})">
            <span class="symbols-small">more_horiz</span>
        </button>
        <div id="hourly{{$loc}}" class="hide">
            <div class="grid-hourly">
                <div class="grid-label"></div>
                <div class="grid-label">Time</div>
                <div class="grid-label">Temp.</div>
                <div class="grid-label">Feels</div>
                <div class="grid-label">Prob.</div>
                <div class="grid-label">Precip.</div>
                <div class="grid-label">Wind</div>
            </div>
            <div class="grid-hourly">
                <div class="grid-label"></div>
                <div class="grid-label"></div>
                <div class="grid-label">
                    {{$hourly.HourlyUnits.Temperature}}
                </div>
                <div class="grid-label">{{$hourly.HourlyUnits.FeelsLike}}</div>
                <div class="grid-label">
                    {{$hourly.HourlyUnits.Probability}}
                </div>
                <div class="grid-label">
                    {{$hourly.HourlyUnits.Precipitation}}
                </div>
                <div class="grid-label">{{$hourly.HourlyUnits.WindSpeed}}</div>
            </div>

            <div class="grid-hourly">
                {{range $index, $time :=$hourly.Hourly.Time}} {{$code := index
                $hourly.Hourly.Code $index}} {{$icon := index $codes $code}}
                <span class="symbols-small">{{$icon}}</span>
                <div class="grid-data">{{$hourly.FormatTime $index}}</div>
                <div class="grid-data">
                    {{index $hourly.Hourly.Temperature $index | printf "%6.1f"
                    }}
                </div>
                <div class="grid-data">
                    {{index $hourly.Hourly.FeelsLike $index | printf "%6.1f" }}
                </div>
                <div class="grid-data">
                    {{index $hourly.Hourly.Probability $index | printf "%6d" }}
                </div>
                <div class="grid-data">
                    {{index $hourly.Hourly.Precipitation $index | printf "%6.2f"
                    }}
                </div>
                <div class="grid-data">
                    {{index $hourly.Hourly.WindSpeed $index | printf "%6.2f" }}
                </div>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>
</div>
{{ end }} {{ define "weather.current" }}
<div id="slot-{{.Action.Name}}" class="slot" draggable="false">
    {{template "layout.content.head" .Action }}
    <div class="content"></div>
</div>
{{ end }}{{ define "weather.readings" }} {{ end }}
