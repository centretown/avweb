{{ define "weather.hourly" }}
<div id="slot-{{.Action.Name}}" class="slot" draggable="false">
    <script>
        var hideHourly = [];
        function toggleHourly(index) {
            let id = "hourly" + index;
            if (hideHourly[index]) {
                hideHourly[index] = false;
                htmx.removeClass("#" + id, "hide");
            } else {
                hideHourly[index] = true;
                htmx.addClass("#" + id, "hide");
            }
        }
        document.getElementById("hourly-date").innerHTML = showFullDate();
    </script>
    {{template "layout.content.head" .Action }}{{$codes := .Codes}}
    <span>
        <div id="hourly-date" class="title-date"></div>
        {{$rt := .Runtime}}
        <div class="content scroll">
            {{range $loc, $location := .Data}}
            <!--  -->
            {{$hourly := $location.WeatherHourly}}
            <!--  -->
            {{$canvasId := "hourly_canvas{{$loc}}"}}
            <!--  -->
            {{template "weather.hourly.titles" $location}}
            <!--  -->
            {{$limit := $hourly.MinMax $hourly.Hourly.Temperature
            $hourly.Hourly.FeelsLike}}
            <!--  -->
            {{$wind := $hourly.MinMax $hourly.Hourly.WindSpeed}}
            <!--  -->
            {{$feels := $hourly.MinMax $hourly.Hourly.FeelsLike}}

            <div class="grid-hour">
                {{$hours:=$hourly.Hours}} {{range $t := $hours}}
                <span class="grid-data">{{$hourly.FormatHour $t}}</span>
                {{end}}
            </div>
            <!--  -->
            {{template "weather.hourly.grid" $location }}
            <div class="grid-minmax">
                <span class="temperature"
                    >{{$limit.Max}}{{$hourly.HourlyUnits.Temperature}}</span
                >
                <span class="temperature-feels"
                    >{{$feels.Max}}{{$hourly.HourlyUnits.FeelsLike}}</span
                >
            </div>
            <canvas
                class="chart-hourly unfade-it"
                id="hourly_canvas{{$loc}}"
            ></canvas>
            <div class="grid-minmax">
                <span class="temperature"
                    >{{$limit.Min}}{{$hourly.HourlyUnits.Temperature}}</span
                >
                <span class="temperature-feels"
                    >{{$feels.Min}}{{$hourly.HourlyUnits.FeelsLike}}</span
                >
            </div>
            <script>
                hideHourly.push(true);
                var id = "hourly_canvas"+{{$loc}};
                showBars(id, {{$hourly.Hourly.Precipitation}},{{$hourly.Hourly.Code}});
                showGraph(id, "rgba(255, 200, 150, 255)", {{$limit.Min}}, {{$limit.Max}}, {{$hourly.Hourly.FeelsLike}});
                showGraph(id, "rgba(255, 150, 0, 255)", {{$limit.Min}}, {{$limit.Max}}, {{$hourly.Hourly.Temperature}}, 3);
                showMinMax(id);
            </script>
            <button class="more" hx-on:click="toggleHourly({{$loc}})">
                <span class="symbols-small">more_horiz</span>
            </button>
            <div id="hourly{{$loc}}" class="hide">
                <div class="grid-hourly">
                    <div class="grid-label"></div>
                    <div class="grid-label">Time</div>
                    <div class="grid-label">Temp</div>
                    <div class="grid-label">Feels</div>
                    <div class="grid-label">Precip</div>
                    <div class="grid-label">Prob</div>
                    <div class="grid-label">Wind</div>
                </div>
                <div class="grid-hourly">
                    <div class="grid-label"></div>
                    <div class="grid-label"></div>
                    <div class="grid-label">
                        {{$hourly.HourlyUnits.Temperature}}
                    </div>
                    <div class="grid-label">
                        {{$hourly.HourlyUnits.FeelsLike}}
                    </div>
                    <div class="grid-label">
                        {{$hourly.HourlyUnits.Precipitation}}
                    </div>
                    <div class="grid-label">
                        {{$hourly.HourlyUnits.Probability}}
                    </div>
                    <div class="grid-label">
                        {{$hourly.HourlyUnits.WindSpeed}}
                    </div>
                </div>

                <div class="grid-hourly">
                    {{range $index, $time :=$hourly.Hourly.Time}} {{$code :=
                    index $hourly.Hourly.Code $index}} {{$wcode := index $codes
                    $code}} {{$icon := $wcode.Icon}}
                    <span class="symbols-small">{{$icon}}</span>
                    <div class="grid-data">{{$hourly.FormatTime $index}}</div>
                    <div class="grid-data">
                        {{index $hourly.Hourly.Temperature $index | printf
                        "%6.1f" }}
                    </div>
                    <div class="grid-data">
                        {{index $hourly.Hourly.FeelsLike $index | printf "%6.1f"
                        }}
                    </div>
                    <div class="grid-data">
                        {{index $hourly.Hourly.Precipitation $index | printf
                        "%6.2f" }}
                    </div>
                    <div class="grid-data">
                        {{index $hourly.Hourly.Probability $index | printf "%6d"
                        }}
                    </div>
                    <div class="grid-data">
                        {{index $hourly.Hourly.WindSpeed $index | printf "%6.2f"
                        }}
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>
    </span>
</div>
{{ end }}
<!--  -->
<!--  -->
{{ define "weather.hourly.titles" }}
<!--  -->
{{$w:=.WeatherHourly}}{{$cur:=$w.Hourly}}{{$units:=$w.HourlyUnits}}
<!--  -->
{{$c:=index $cur.Code 0}} {{$code:=$w.WeatherCode $c}}
<div class="title-weather">
    <div class="title-city item-city">{{.City}}</div>
    <div class="title-left">
        <span class="symbols-weather" style="color:{{$code.Color}}"
            >{{$code.Icon}}</span
        >
        <span class="temperature"
            >{{index $cur.Temperature 0}}{{$units.Temperature}}</span
        >
    </div>

    <div class="title-right">
        <span class="temperature-feels"
            >Feels {{index $cur.FeelsLike 0}}{{$units.FeelsLike}}</span
        >
        <span class="symbols-weather temperature-feels">airwave</span>
    </div>
    <div class="title-left">
        <span class="symbols-weather precipitation">weather_mix</span>
        <span class="precipitation">
            {{index $cur.Precipitation 0}} {{$units.Precipitation}}
        </span>
    </div>
    <div class="title-right">
        <span class="precipitation">
            POP {{index $cur.Probability 0}}{{$units.Probability}}
        </span>
        <span class="symbols-weather precipitation">weather_mix</span>
    </div>

    <div class="title-left">
        <span class="symbols-weather windspeed">toys_fan</span>
        <span class="windspeed"
            >{{index $cur.WindSpeed 0}} {{$units.WindSpeed}} {{index
            $cur.WindDirection 0}}{{$units.WindDirection}}
        </span>
    </div>
    <div class="title-right">
        <span class="windspeed"
            >Gusts {{index $cur.WindGusts 0}} {{$units.WindSpeed}}
        </span>
        <span class="symbols-weather windspeed">air</span>
    </div>

    <div class="title-left">
        <span class="symbols-weather humidity">humidity_mid</span>
        <span class="humidity"
            >{{index $cur.Humidity 0}} {{$units.Humidity}}
        </span>
    </div>
    <span></span>
    <div class="title-right">
        <span class="pressure"
            >{{index $cur.Pressure 0}} {{$units.Pressure}}
        </span>
        <span class="symbols-weather pressure">compress</span>
    </div>
</div>
{{ end }}
<!--  -->
<!--  -->
{{ define "weather.hourly.grid" }}
<!--  -->
{{$hourly := .WeatherHourly}}
<div class="grid-icon24">
    {{range $code := $hourly.Hourly.Code}} {{$wcode := $hourly.WeatherCode
    $code}}
    <span class="symbols-weather" style="color:{{$wcode.Color}}"
        >{{$wcode.Icon}}</span
    >
    {{end}}
</div>
{{ end }}
