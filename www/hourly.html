{{ define "weather.hourly" }}
<div id="slot-{{.Action.Name}}" class="slot" draggable="false">
    <script>
        var hideHourly = [];
        function toggleHourly(index) {
            let id = "hourly" + index;
            if (hideHourly[index]) {
                hideHourly[index] = false;
                htmx.removeClass("#" + id, "hide");
            } else {
                hideHourly[index] = true;
                htmx.addClass("#" + id, "hide");
            }
        }
        document.getElementById("hourly-date").innerHTML = showFullDate();
    </script>
    {{template "layout.content.head" .Action }}{{$codes := .Codes}}
    <span>
        <div id="hourly-date" class="title-date"></div>
        <div class="content scroll">
            {{$rt := .Runtime}} {{range $loc, $location := .Data}} {{$hourly :=
            $location.WeatherHourly}}{{$canvasId :=
            "hourly_canvas{{$loc}}"}}{{$fmt := $rt.CurrentWeatherHourly $loc}}
            <div class="title">
                <span class="title-left temperature"
                    >Temperature {{$fmt.Temperature}}</span
                >
                <span class="title-city">{{$location.City}}</span>
                <span class="title-right temperature-feels"
                    >Feels Like {{$fmt.FeelsLike}}</span
                >
                <span class="title-left precipitation">
                    Precipitation {{$fmt.Precipitation}}
                    ({{$fmt.Probability}})</span
                >
                <span class="title-center"></span>
                <span class="title-right windspeed"
                    >Wind {{$fmt.WindSpeed}}</span
                >
            </div>

            <div class="grid-icon24">
                {{$icons:=$hourly.Icons $hourly.Hourly.Code 1}} {{range $icon :=
                $icons}}
                <span class="symbols-weather">{{$icon}}</span>
                {{end}}
            </div>
            <div class="grid-hour">
                {{$hours:=$hourly.Hours}} {{range $t := $hours}}
                <span class="grid-data">{{$hourly.FormatHour $t}}</span>
                {{end}}
            </div>
            {{$limit := $hourly.MinMax $hourly.Hourly.Temperature
            $hourly.Hourly.FeelsLike}} {{$wind := $hourly.MinMax
            $hourly.Hourly.WindSpeed}}
            <div class="grid-minmax">
                <span class="temperature"
                    >{{$limit.Max}}{{$hourly.HourlyUnits.Temperature}}</span
                >
                <span class="windspeed"
                    >{{$wind.Max}} {{$hourly.HourlyUnits.WindSpeed}}</span
                >
            </div>
            <canvas
                class="chart-hourly unfade-it"
                id="hourly_canvas{{$loc}}"
            ></canvas>
            <div class="grid-minmax">
                <span class="temperature"
                    >{{$limit.Min}}{{$hourly.HourlyUnits.Temperature}}</span
                >
                <span class="windspeed"
                    >{{$wind.Min}} {{$hourly.HourlyUnits.WindSpeed}}</span
                >
            </div>
            <script>
                hideHourly.push(true);
                var id = "hourly_canvas"+{{$loc}};
                showBars(id, {{$hourly.Hourly.Precipitation}},{{$hourly.Hourly.Code}});
                showGraph(id, "yellow", {{$wind.Min}}, {{$wind.Max}}, {{$hourly.Hourly.WindSpeed}});
                showGraph(id, "orange", {{$limit.Min}}, {{$limit.Max}}, {{$hourly.Hourly.Temperature}});
                showGraph(id, "green", {{$limit.Min}}, {{$limit.Max}}, {{$hourly.Hourly.FeelsLike}});
                showMinMax(id);
            </script>
            <button class="more" hx-on:click="toggleHourly({{$loc}})">
                <span class="symbols-small">more_horiz</span>
            </button>
            <div id="hourly{{$loc}}" class="hide">
                <div class="grid-hourly">
                    <div class="grid-label"></div>
                    <div class="grid-label">Time</div>
                    <div class="grid-label">Temp</div>
                    <div class="grid-label">Feels</div>
                    <div class="grid-label">Precip</div>
                    <div class="grid-label">Prob</div>
                    <div class="grid-label">Wind</div>
                </div>
                <div class="grid-hourly">
                    <div class="grid-label"></div>
                    <div class="grid-label"></div>
                    <div class="grid-label">
                        {{$hourly.HourlyUnits.Temperature}}
                    </div>
                    <div class="grid-label">
                        {{$hourly.HourlyUnits.FeelsLike}}
                    </div>
                    <div class="grid-label">
                        {{$hourly.HourlyUnits.Precipitation}}
                    </div>
                    <div class="grid-label">
                        {{$hourly.HourlyUnits.Probability}}
                    </div>
                    <div class="grid-label">
                        {{$hourly.HourlyUnits.WindSpeed}}
                    </div>
                </div>

                <div class="grid-hourly">
                    {{range $index, $time :=$hourly.Hourly.Time}} {{$code :=
                    index $hourly.Hourly.Code $index}} {{$wcode := index $codes
                    $code}} {{$icon := $wcode.Icon}}
                    <span class="symbols-small">{{$icon}}</span>
                    <div class="grid-data">{{$hourly.FormatTime $index}}</div>
                    <div class="grid-data">
                        {{index $hourly.Hourly.Temperature $index | printf
                        "%6.1f" }}
                    </div>
                    <div class="grid-data">
                        {{index $hourly.Hourly.FeelsLike $index | printf "%6.1f"
                        }}
                    </div>
                    <div class="grid-data">
                        {{index $hourly.Hourly.Precipitation $index | printf
                        "%6.2f" }}
                    </div>
                    <div class="grid-data">
                        {{index $hourly.Hourly.Probability $index | printf "%6d"
                        }}
                    </div>
                    <div class="grid-data">
                        {{index $hourly.Hourly.WindSpeed $index | printf "%6.2f"
                        }}
                    </div>
                    {{end}}
                </div>
            </div>
            {{end}}
        </div>
    </span>
</div>
{{ end }}
